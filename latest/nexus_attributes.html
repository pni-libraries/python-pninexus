

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Working with attributes &#8212; pninexus (latest) documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Working with links" href="nexus_links.html" />
    <link rel="prev" title="Working with fields" href="nexus_fields.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="nexus_links.html" title="Working with links"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nexus_fields.html" title="Working with fields"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pninexus (latest) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="users_guide.html" >Users Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="using_nexus.html" accesskey="U">Using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pninexus.nexus</span></code> package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with attributes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="working-with-attributes">
<h1>Working with attributes<a class="headerlink" href="#working-with-attributes" title="Permalink to this headline">¶</a></h1>
<p>Fields and groups can have attributes attached which provide additional
metadata. In fact Nexus makes heavy use of attributes to store additional
information about a field or group. It is thus not recommended to use
attributes too excessively as one may runs into name conflicts with future Nexus
development.
Attributes can be accessed from fields and groups via their <code class="xref py py-attr docutils literal notranslate"><span class="pre">attributes</span></code>
member. Attributes behave basically like fields with some restrictions</p>
<ul class="simple">
<li><p>they cannot grow</p></li>
<li><p>one cannot apply compression to attributes.</p></li>
</ul>
<p>Due to this restrictions one should not use attributes to store large amounts of
data.</p>
<p>To create attributes use the <code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code> method of the
<code class="xref py py-obj docutils literal notranslate"><span class="pre">attributes</span></code> member</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pninexus.nexus</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="n">field</span> <span class="o">=</span> <span class="o">....</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>which would create a scalar attribute of name <code class="docutils literal notranslate"><span class="pre">temperature</span></code> and with a 32-bit
floating point type. Multidimensional attributes can be created with the
optional <code class="docutils literal notranslate"><span class="pre">shape</span></code> keyword argument</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
<p>If an attribute already exists it can be overwritten using the <code class="docutils literal notranslate"><span class="pre">overwrite</span></code>
keyword argument (<code class="xref py py-const docutils literal notranslate"><span class="pre">False</span></code> by default).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;float32&quot;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="attribute-inquiry">
<h2>Attribute inquiry<a class="headerlink" href="#attribute-inquiry" title="Permalink to this headline">¶</a></h2>
<p>Like fields and groups attributes have a couple of properties which can be
queried to obtain metadata for a particular attribute instance</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>property</p></th>
<th class="head"><p>description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">shape</span></code></p></td>
<td><p>a tuple with the number of elements along each
dimension of the attribute</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">dtype</span></code></p></td>
<td><p>the string representation of the attributes data type</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">is_valid</span></code></p></td>
<td><p>true if the attribute is a valid object</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">name</span></code></p></td>
<td><p>the name of the attribute (the key which can be used
to retrieve the attribute from its parent)</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">value</span></code></p></td>
<td><p>provides access to the attributes data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">path</span></code></p></td>
<td><p>returns the path of the attribute</p></td>
</tr>
</tbody>
</table>
<p>The following code</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#File: attributes_properties.py</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pni.io.nx.h5</span> <span class="k">as</span> <span class="nn">nexus</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="s2">&quot;attributes_properties.nxs&quot;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>

<span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{name:20}</span><span class="s2"> : </span><span class="si">{path:20}</span><span class="s2"> type=</span><span class="si">{dtype:&lt;10}</span><span class="s2"> size=</span><span class="si">{size:&lt;20}</span><span class="s2">&quot;</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">path</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">path</span><span class="p">,</span>
                     <span class="n">dtype</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>will produce</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>HDF5_Version         : /@HDF5_Version       <span class="nv">type</span><span class="o">=</span>string     <span class="nv">size</span><span class="o">=</span><span class="m">1</span>
NX_class             : /@NX_class           <span class="nv">type</span><span class="o">=</span>string     <span class="nv">size</span><span class="o">=</span><span class="m">1</span>
file_name            : /@file_name          <span class="nv">type</span><span class="o">=</span>string     <span class="nv">size</span><span class="o">=</span><span class="m">1</span>
file_time            : /@file_time          <span class="nv">type</span><span class="o">=</span>string     <span class="nv">size</span><span class="o">=</span><span class="m">1</span>
file_update_time     : /@file_update_time   <span class="nv">type</span><span class="o">=</span>string     <span class="nv">size</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="section" id="attribute-retrieval-and-iteration">
<h2>Attribute retrieval and iteration<a class="headerlink" href="#attribute-retrieval-and-iteration" title="Permalink to this headline">¶</a></h2>
<p>There are basically three ways to to access the attributes attached to a group
or a field</p>
<ul class="simple">
<li><p>by name via <code class="xref py py-meth docutils literal notranslate"><span class="pre">__getitem__()</span></code> (using <cite>[]</cite>)</p></li>
<li><p>by the attributes index</p></li>
<li><p>by an iterator.</p></li>
</ul>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">attributes</span></code> attribute of groups and fields exposes an iterable
interface. The following example shows all three ways how to access the
attributes of a files root group</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#File: attribute_access.py</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pni.io.nx.h5</span> <span class="k">as</span> <span class="nn">nexus</span> 

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="s2">&quot;attributes_access.nxs&quot;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>

<span class="c1">#access attributes via their index</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Access attributes via index&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attributes</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{index}</span><span class="s2">: </span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                                   <span class="n">name</span><span class="o">=</span><span class="n">r</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="c1">#access attributes via iterator</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Access attributes via iterator&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">attr</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1">#access directly via name </span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;HDF5_Version&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

</pre></div>
</div>
<p>The output is</p>
</div>
<div class="section" id="reading-and-writing-data-from-and-to-an-attribute">
<h2>Reading and writing data from and to an attribute<a class="headerlink" href="#reading-and-writing-data-from-and-to-an-attribute" title="Permalink to this headline">¶</a></h2>
<p>Concerning IO operations attributes heave pretty much like fields as shown in
the next example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#File: attribute_io.py</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pni.io.nx.h5</span> <span class="k">as</span> <span class="nn">nexus</span> 

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">create_file</span><span class="p">(</span><span class="s2">&quot;attribute_io.nxs&quot;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">samptr</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;scan_1&quot;</span><span class="p">,</span><span class="s2">&quot;NXentry&quot;</span><span class="p">)</span><span class="o">.</span> \
                  <span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;instrument&quot;</span><span class="p">,</span><span class="s2">&quot;NXinstrument&quot;</span><span class="p">)</span><span class="o">.</span> \
                  <span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span><span class="s2">&quot;NXsample&quot;</span><span class="p">)</span><span class="o">.</span> \
                  <span class="n">create_group</span><span class="p">(</span><span class="s2">&quot;transformations&quot;</span><span class="p">,</span><span class="s2">&quot;NXtransformations&quot;</span><span class="p">)</span>

<span class="n">samptr</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">create_field</span><span class="p">(</span><span class="s2">&quot;depends_on&quot;</span><span class="p">,</span><span class="s2">&quot;string&quot;</span><span class="p">)[</span><span class="o">...</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;transformation/tt&quot;</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">samptr</span><span class="o">.</span><span class="n">create_field</span><span class="p">(</span><span class="s2">&quot;tt&quot;</span><span class="p">,</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">tt</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
<span class="n">tt</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;transformation_type&quot;</span><span class="p">,</span><span class="s2">&quot;str&quot;</span><span class="p">)[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;rotation&quot;</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">tt</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">,</span><span class="s2">&quot;float64&quot;</span><span class="p">,</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;r=&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x=&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y=&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;z=&quot;</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">r</span><span class="o">=</span> <span class="o">[</span>-1.  <span class="m">0</span>.  <span class="m">0</span>.<span class="o">]</span>
<span class="nv">x</span><span class="o">=</span> -1.0
<span class="nv">y</span><span class="o">=</span> <span class="m">0</span>.0
<span class="nv">z</span><span class="o">=</span> <span class="m">0</span>.0
</pre></div>
</div>
<p>There is not too much more to day about that. When reading and writing
multidimensional data numpy arrays must be used in any case (also for strings).</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working with attributes</a><ul>
<li><a class="reference internal" href="#attribute-inquiry">Attribute inquiry</a></li>
<li><a class="reference internal" href="#attribute-retrieval-and-iteration">Attribute retrieval and iteration</a></li>
<li><a class="reference internal" href="#reading-and-writing-data-from-and-to-an-attribute">Reading and writing data from and to an attribute</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nexus_fields.html"
                        title="previous chapter">Working with fields</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="nexus_links.html"
                        title="next chapter">Working with links</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><p>
  <h3 class='versions'>Versions</h3>
  <p>
    <ul>
      <li><a class="reference external" href="index/../../latest/index.html">v:latest</a></li>
      <li><a class="reference external" href="index/../../stable/index.html">v:stable</a></li>
      
      <li><a class="reference external" href="index/../../v3.0.1/index.html">v3.0.1</a></li>
      <li><a class="reference external" href="index/../../v2.0.0/index.html">v2.0.0</a></li>
      <li><a class="reference external" href="index/../../v1.3.4/index.html">v1.3.4</a></li>
      
    </ul>
  </p>
</p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="nexus_links.html" title="Working with links"
             >next</a> |</li>
        <li class="right" >
          <a href="nexus_fields.html" title="Working with fields"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pninexus (latest) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="users_guide.html" >Users Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="using_nexus.html" >Using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pninexus.nexus</span></code> package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with attributes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, DESY.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>