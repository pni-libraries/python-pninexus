

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Working with links &#8212; pninexus (latest) documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bizstyle.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Nexus and XML" href="nexus_xml.html" />
    <link rel="prev" title="Working with attributes" href="nexus_attributes.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="nexus_xml.html" title="Nexus and XML"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="nexus_attributes.html" title="Working with attributes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pninexus (latest) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="users_guide.html" >Users Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="using_nexus.html" accesskey="U">Using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pninexus.nexus</span></code> package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with links</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="working-with-links">
<h1>Working with links<a class="headerlink" href="#working-with-links" title="Permalink to this headline">¶</a></h1>
<p>Nexus files support two kinds of links</p>
<ul class="simple">
<li><p><em>internal</em> links between objects within the same file</p></li>
<li><p>and <em>external</em> links between objects in different files</p></li>
</ul>
<p>Links are an appropriate tool to avoid data duplication. A typical application
for links are the fields in the <em>NXdata</em> instance below <em>NXentry</em>. <em>NXdata</em>
provides data recorded during a measurement intended for easy plotting.  In
virtually all cases the data which should go to <em>NXdata</em> is already stored in
other places within the same NeXus file.  Without links we would have to copy
this data to <em>NXdata</em> which would be an awefull waste of time and space in
particular when the amount of data is getting large (think of a 3D image block
recorded with a 2D detector).</p>
<p>With links we can simply provide references to the original data below
<em>NXdata</em>.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/link.svg"><img alt="_images/link.svg" src="_images/link.svg" width="100%" /></a>
<p class="caption"><span class="caption-text">The internal links in <em>NXdata</em> point to already existing data in
other locations within the same file. This avoids data duplication
within a single file.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>In the above example the <em>data</em> and <em>position</em> field are members of the
<em>NXdetector</em> and <em>NXsample</em> group respectively. However, by means of links
we can make these two fields available as children of the <em>NXdata</em> group
without copying data. In this case internal links have been used as all data
resides in the same file. The red lines in the sketch denote the links</p>
<p>For <em>external</em>-links the canonical use case is a detector which writes its own
NeXus file with data (we will refer to this file as the <em>detector</em>-file).
All additional data is writen by the control system to a second NeXus file
which we will call <em>master</em>-file. To make the detector data available from the
<em>master</em>-file we have two possibilities</p>
<ul class="simple">
<li><p>either copy the entire data to the <em>master</em>-file</p></li>
<li><p>or use an <em>external</em>-link.</p></li>
</ul>
<p>The drawbacks of the former solution are obvious: we would need to copy all the
data to a different file. However, with <em>external</em>-links we can do something
like this</p>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/external_link.svg"><img alt="_images/external_link.svg" src="_images/external_link.svg" width="100%" /></a>
<p class="caption"><span class="caption-text">With an external link we can avoid copying data between two individual
NeXus files. The data in the detector file can be accessed easily from
within the master file.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>Here the detector group can be accessed from the <em>master</em>-file as if it would
be a part of it. The link is totally transparent to the user.</p>
<div class="section" id="creating-links">
<h2>Creating links<a class="headerlink" href="#creating-links" title="Permalink to this headline">¶</a></h2>
<div class="section" id="internal-links">
<h3>Internal links<a class="headerlink" href="#internal-links" title="Permalink to this headline">¶</a></h3>
<p>Links are created using the <code class="xref py py-func docutils literal notranslate"><span class="pre">link()</span></code> function.
The signature of the function is the same for internal and external links.
Only the path to the link target differs.
An internal links can be created linke this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pninexus.nexus</span> <span class="k">as</span> <span class="nn">nexus</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;master.nxs&quot;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s2">&quot;/:NXentry/:NXdata&quot;</span><span class="p">)</span>

<span class="n">nexus</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="s2">&quot;/entry/instrument/detector/data&quot;</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-func docutils literal notranslate"><span class="pre">link()</span></code> function creates now a link to the <em>data</em> field below
<em>NXdata</em> with name <em>data</em>. The important thing to note here is that the path
pointing to the link target must not contain elements that consist only of
types (path elements like <code class="docutils literal notranslate"><span class="pre">/:NXentry/</span></code> for instance. This due to the fact,
that the linking feature is provided by the HDF5 library which has no idea
about NeXus semantics.  The object the HDF5 path referes to must not
necessarily  exist at link time.  Alternatively, within a file we can do a link
of an existing object. In this case the above example would look like this</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pninexus.nexus</span> <span class="k">as</span> <span class="nn">nexus</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;master.nxs&quot;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s2">&quot;/:NXentry/:NXinstrument/:NXdetector/data&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s2">&quot;/:NXentry/:NXdata&quot;</span><span class="p">)</span>

<span class="n">nexus</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">detector</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case the object we are linking to must obviously exist in order to make
the call to <code class="xref py py-func docutils literal notranslate"><span class="pre">get_object()</span></code> successful.</p>
</div>
<div class="section" id="external-links">
<h3>External links<a class="headerlink" href="#external-links" title="Permalink to this headline">¶</a></h3>
<p>Creating an external links is quite similar to the first example shown above
for internal links. The only difference is that the path to the link target
starts with a filename</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">pninexus.nexus</span> <span class="k">as</span> <span class="nn">nexus</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;master.nxs&quot;</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">()</span>
<span class="n">detector</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s2">&quot;/:NXentry/:NXinstrument/:NXdetector&quot;</span><span class="p">)</span>

<span class="n">nexus</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="s2">&quot;detector.nxs://entry/instrument/detector/data&quot;</span><span class="p">,</span><span class="n">detector</span><span class="p">,</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For external links relative paths to the file should be used. Otherwise moving
the files to a different file system can cause unresolvable links!</p>
</div>
</div>
<div class="section" id="using-links-in-existing-files">
<h2>Using links in existing files<a class="headerlink" href="#using-links-in-existing-files" title="Permalink to this headline">¶</a></h2>
<p>Links can also be used to create more robust parsers for NeXus files.
In many cases files may contain unresolvable links (typically external ones).
As an alternative to iterating over a group one could use either
<code class="xref py py-func docutils literal notranslate"><span class="pre">get_links()</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">get_links_recursive()</span></code> in order to obtain
a list of links in the file and investigate their status before accessing the
objects the links refer to.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pninexus.nexus</span> <span class="k">as</span> <span class="nn">nexus</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="s2">&quot;scan_000001.nxs&quot;</span><span class="p">)</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">root</span><span class="p">(),</span><span class="s2">&quot;/:NXentry&quot;</span><span class="p">)</span>
<span class="n">links</span> <span class="o">=</span> <span class="n">nexus</span><span class="o">.</span><span class="n">get_links_recursive</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

<span class="n">broken_links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">nexus</span><span class="o">.</span><span class="n">nxlink_status</span><span class="o">.</span><span class="n">INVALID</span><span class="p">]</span>
<span class="n">objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">nexus</span><span class="o">.</span><span class="n">nxlink_status</span><span class="o">.</span><span class="n">VALID</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_links_recursive()</span></code> returns a list of all links (instances of
<code class="xref py py-class docutils literal notranslate"><span class="pre">nxlink</span></code>) below <code class="xref py py-obj docutils literal notranslate"><span class="pre">entry</span></code> and its subgroups. Since links do not
access the objects they are refering to no exception will be thrown if one of
the links cannot be resolved due to a missing target.  The list
<code class="xref py py-obj docutils literal notranslate"><span class="pre">borken_links</span></code> holds all links which are not resolveable in the file
while <code class="xref py py-obj docutils literal notranslate"><span class="pre">objects</span></code> the objects refered to by all valid links.</p>
<p><code class="xref py py-func docutils literal notranslate"><span class="pre">get_links()</span></code> returns only a list of the direct children of a group.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working with links</a><ul>
<li><a class="reference internal" href="#creating-links">Creating links</a><ul>
<li><a class="reference internal" href="#internal-links">Internal links</a></li>
<li><a class="reference internal" href="#external-links">External links</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-links-in-existing-files">Using links in existing files</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="nexus_attributes.html"
                        title="previous chapter">Working with attributes</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="nexus_xml.html"
                        title="next chapter">Nexus and XML</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><p>
  <h3 class='versions'>Versions</h3>
  <p>
    <ul>
      <li><a class="reference external" href="index/../../latest/index.html">v:latest</a></li>
      <li><a class="reference external" href="index/../../stable/index.html">v:stable</a></li>
      
      <li><a class="reference external" href="index/../../v2.0.0/index.html">v2.0.0</a></li>
      <li><a class="reference external" href="index/../../v1.3.4/index.html">v1.3.4</a></li>
      
    </ul>
  </p>
</p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="nexus_xml.html" title="Nexus and XML"
             >next</a> |</li>
        <li class="right" >
          <a href="nexus_attributes.html" title="Working with attributes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">pninexus (latest) documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="users_guide.html" >Users Guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="using_nexus.html" >Using the <code class="xref py py-mod docutils literal notranslate"><span class="pre">pninexus.nexus</span></code> package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Working with links</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, DESY.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.3.
    </div>
  </body>
</html>